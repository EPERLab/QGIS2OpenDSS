# -*- coding: utf-8 -*-
from builtins import str
from qgis.core import QgsProject, QgsMessageLog

from PyQt5.QtCore import *
from PyQt5 import QtCore 

from PyQt5.QtGui import QDesktopServices
from PyQt5 import QtGui #Paquetes requeridos para crear ventanas de diálogo e interfaz gráfica.
from PyQt5 import QtWidgets
from PyQt5.QtWidgets import QApplication, QWidget, QInputDialog, QLineEdit, QFileDialog, QMessageBox
import traceback

from qgis.core import *  # Paquetes requeridos para crer el registro de eventos.
from qgis.gui import *  # Paquete requerido para desplegar mensajes en la ventana principal de QGIS.

def renameVoltage(MVCode, LVCode): #Para monofasicos, tension L-N, para trifasicos tension L-L
        MV={'LN':0,'LL':0}
        LV={'LN':0,'LL':0}
        #MV
        if MVCode == 380:
            MV = {'LN': 19.92, 'LL': 34.5}
        elif MVCode == 340:
            MV = {'LN': 14.38, 'LL': 24.9}
        elif MVCode == 270:
            MV = {'LN': 7.97,'LL': 13.8}   
        elif MVCode == 230:
            MV = {'LN': 7.62, 'LL': 13.2} 
        elif MVCode == 150:
            MV = {'LN': 7.2, 'LL': 7.2}
        elif MVCode == 120:
            MV = {'LN': 2.40, 'LL': 4.16}
        elif MVCode == 80:
            MV = {'LN': 2.40, 'LL': 2.40}
        
        #LV
        # Casos mv-mv
        if LVCode == 340:
            LV = {'LN': 14.38, 'LL': 24.9}
        if LVCode == 270:
            LV = {'LN': 7.97, 'LL': 13.8}    
        if LVCode == 210:
            LV = {'LN': 7.22, 'LL': 12.5}
        if LVCode == 120:
            LV = {'LN': 2.40, 'LL': 4.16}
        if LVCode == 80:
            LV = {'LN': 2.40, 'LL': 2.40}
        
        
        # Casos BT
        if LVCode == 70:
            LV = {'LN': 0.24, 'LL': 0.416}
        elif LVCode == 60:
            LV = {'LN': 0.48, 'LL': 0.48} #Conexión delta 3 conductores
        elif LVCode == 50:
            LV = {'LN': 0.277, 'LL': 0.48}    
        elif LVCode == 40:
            LV = {'LN': 0.240, 'LL': 0.48}
        elif LVCode == 35:
            LV = {'LN': 0.254, 'LL': 0.44}
        elif LVCode == 30:
            LV = {'LN': 0.12, 'LL': 0.24}
        elif LVCode == 20:
            LV = {'LN': 0.12, 'LL': 0.208}
        
        voltageCodes={'MVCode':MV, 'LVCode':LV}
        return voltageCodes

react_list1F3W={ # List of reactances for single phase three winding transformers
            '2.4':{
                    '0.12': {
                            '3': 'Xhl=0.82 Xht=0.82 Xlt=0.55',
                            '5': 'Xhl=0.82 Xht=0.82 Xlt=0.55',
                            '10': 'Xhl=1.54 Xht=1.54 Xlt=1.03',
                            '15': 'Xhl=1.19 Xht=1.19 Xlt=0.80',
                            '25': 'Xhl=1.49 Xht=1.49 Xlt=1.00',
                            '37': 'Xhl=1.71 Xht=1.71 Xlt=1.14',
                            '50': 'Xhl=1.86 Xht=1.86 Xlt=1.24',
                            '75': 'Xhl=1.80 Xht=1.80 Xlt=1.20',
                            '100': 'Xhl=2.14 Xht=2.14 Xlt=1.43',   
                            '167': 'Xhl=2.35 Xht=2.35 Xlt=1.57', 
                            '250': 'Xhl=3.17 Xht=3.17 Xlt=2.11',
                            '333': 'Xhl=3.52 Xht=3.52 Xlt=2.35',
                            '500': 'Xhl=3.61 Xht=3.61 Xlt=2.40'},
                    '0.24':{
                            '3': 'Xhl=1.31 Xht=1.31 Xlt=0.87',
                            '5': 'Xhl=1.31 Xht=1.31 Xlt=0.87',
                            '10': 'Xhl=1.40 Xht=1.40 Xlt=0.94',
                            '15': 'Xhl=1.19 Xht=1.19 Xlt=0.79',
                            '25': 'Xhl=1.49 Xht=1.49 Xlt=0.99',
                            '37': 'Xhl=1.70 Xht=1.70 Xlt=1.14',
                            '50': 'Xhl=1.86 Xht=1.86 Xlt=1.24',
                            '75': 'Xhl=1.80 Xht=1.80 Xlt=1.20',
                            '100': 'Xhl=1.94 Xht=1.94 Xlt=1.30',
                            '167': 'Xhl=2.15 Xht=2.15 Xlt=1.43',
                            '250': 'Xhl=2.69 Xht=2.69 Xlt=1.79',
                            '333': 'Xhl=2.66 Xht=2.66 Xlt=1.78',
                            '500': 'Xhl=2.76 Xht=2.76 Xlt=1.84'}},
            '4.16':{
                    '0.12': {
                            '3': 'Xhl=0.82 Xht=0.82 Xlt=0.55',
                            '5': 'Xhl=0.82 Xht=0.82 Xlt=0.55',
                            '10': 'Xhl=1.54 Xht=1.54 Xlt=1.03',
                            '15': 'Xhl=1.19 Xht=1.19 Xlt=0.80',
                            '25': 'Xhl=1.49 Xht=1.49 Xlt=1.00',
                            '37': 'Xhl=1.71 Xht=1.71 Xlt=1.14',
                            '50': 'Xhl=1.86 Xht=1.86 Xlt=1.24',
                            '75': 'Xhl=1.80 Xht=1.80 Xlt=1.20',
                            '100': 'Xhl=2.14 Xht=2.14 Xlt=1.43',   
                            '167': 'Xhl=2.35 Xht=2.35 Xlt=1.57', 
                            '250': 'Xhl=3.17 Xht=3.17 Xlt=2.11',
                            '333': 'Xhl=3.52 Xht=3.52 Xlt=2.35',
                            '500': 'Xhl=3.61 Xht=3.61 Xlt=2.40'},
                    '0.24':{
                            '3': 'Xhl=1.31 Xht=1.31 Xlt=0.87',
                            '5': 'Xhl=1.31 Xht=1.31 Xlt=0.87',
                            '10': 'Xhl=1.40 Xht=1.40 Xlt=0.94',
                            '15': 'Xhl=1.19 Xht=1.19 Xlt=0.79',
                            '25': 'Xhl=1.49 Xht=1.49 Xlt=0.99',
                            '37': 'Xhl=1.70 Xht=1.70 Xlt=1.14',
                            '50': 'Xhl=1.86 Xht=1.86 Xlt=1.24',
                            '75': 'Xhl=1.80 Xht=1.80 Xlt=1.20',
                            '100': 'Xhl=1.94 Xht=1.94 Xlt=1.30',
                            '167': 'Xhl=2.15 Xht=2.15 Xlt=1.43',
                            '250': 'Xhl=2.69 Xht=2.69 Xlt=1.79',
                            '333': 'Xhl=2.66 Xht=2.66 Xlt=1.78',
                            '500': 'Xhl=2.76 Xht=2.76 Xlt=1.84'}},
                '7.2':{
                    '0.12': {
                            '3': 'Xhl=0.82 Xht=0.82 Xlt=0.55',
                            '5': 'Xhl=0.82 Xht=0.82 Xlt=0.55',
                            '10': 'Xhl=1.54 Xht=1.54 Xlt=1.03',
                            '15': 'Xhl=1.19 Xht=1.19 Xlt=0.80',
                            '25': 'Xhl=1.49 Xht=1.49 Xlt=1.00',
                            '37': 'Xhl=1.71 Xht=1.71 Xlt=1.14',
                            '50': 'Xhl=1.86 Xht=1.86 Xlt=1.24',
                            '75': 'Xhl=1.80 Xht=1.80 Xlt=1.20',
                            '100': 'Xhl=2.14 Xht=2.14 Xlt=1.43',   
                            '167': 'Xhl=2.35 Xht=2.35 Xlt=1.57', 
                            '250': 'Xhl=3.17 Xht=3.17 Xlt=2.11',
                            '333': 'Xhl=3.52 Xht=3.52 Xlt=2.35',
                            '500': 'Xhl=3.61 Xht=3.61 Xlt=2.40'},
                    '0.24':{
                            '3': 'Xhl=1.31 Xht=1.31 Xlt=0.87',
                            '5': 'Xhl=1.31 Xht=1.31 Xlt=0.87',
                            '10': 'Xhl=1.40 Xht=1.40 Xlt=0.94',
                            '15': 'Xhl=1.19 Xht=1.19 Xlt=0.79',
                            '25': 'Xhl=1.49 Xht=1.49 Xlt=0.99',
                            '37': 'Xhl=1.70 Xht=1.70 Xlt=1.14',
                            '50': 'Xhl=1.86 Xht=1.86 Xlt=1.24',
                            '75': 'Xhl=1.80 Xht=1.80 Xlt=1.20',
                            '100': 'Xhl=1.94 Xht=1.94 Xlt=1.30',
                            '167': 'Xhl=2.15 Xht=2.15 Xlt=1.43',
                            '250': 'Xhl=2.69 Xht=2.69 Xlt=1.79',
                            '333': 'Xhl=2.66 Xht=2.66 Xlt=1.78',
                            '500': 'Xhl=2.76 Xht=2.76 Xlt=1.84'}},

                '13.8':{      
                    '0.12': {
                            '3': 'Xhl=0.82 Xht=0.82 Xlt=0.55',
                            '5': 'Xhl=0.82 Xht=0.82 Xlt=0.55',
                            '10': 'Xhl=1.54 Xht=1.54 Xlt=1.03',
                            '15': 'Xhl=1.19 Xht=1.19 Xlt=0.80',
                            '25': 'Xhl=1.49 Xht=1.49 Xlt=1.00',
                            '37': 'Xhl=1.71 Xht=1.71 Xlt=1.14',
                            '50': 'Xhl=1.86 Xht=1.86 Xlt=1.24',
                            '75': 'Xhl=1.80 Xht=1.80 Xlt=1.20',
                            '100': 'Xhl=2.14 Xht=2.14 Xlt=1.43',   
                            '167': 'Xhl=2.35 Xht=2.35 Xlt=1.57', 
                            '250': 'Xhl=3.17 Xht=3.17 Xlt=2.11',
                            '333': 'Xhl=3.52 Xht=3.52 Xlt=2.35',
                            '500': 'Xhl=3.61 Xht=3.61 Xlt=2.40'},
                    '0.24':{
                            '3': 'Xhl=1.31 Xht=1.31 Xlt=0.87',
                            '5': 'Xhl=1.31 Xht=1.31 Xlt=0.87',
                            '10': 'Xhl=1.40 Xht=1.40 Xlt=0.94',
                            '15': 'Xhl=1.19 Xht=1.19 Xlt=0.79',
                            '25': 'Xhl=1.49 Xht=1.49 Xlt=0.99',
                            '37': 'Xhl=1.70 Xht=1.70 Xlt=1.14',
                            '50': 'Xhl=1.86 Xht=1.86 Xlt=1.24',
                            '75': 'Xhl=1.80 Xht=1.80 Xlt=1.20',
                            '100': 'Xhl=1.94 Xht=1.94 Xlt=1.30',
                            '167': 'Xhl=2.15 Xht=2.15 Xlt=1.43',
                            '250': 'Xhl=2.69 Xht=2.69 Xlt=1.79',
                            '333': 'Xhl=2.66 Xht=2.66 Xlt=1.78',
                            '500': 'Xhl=2.76 Xht=2.76 Xlt=1.84'}},
              
              '24.9':{
                    '0.12': {
                            '3': 'Xhl=0.82 Xht=0.82 Xlt=0.55',
                            '5': 'Xhl=0.82 Xht=0.82 Xlt=0.55',
                            '10': 'Xhl=1.54 Xht=1.54 Xlt=1.03',
                            '15': 'Xhl=1.19 Xht=1.19 Xlt=0.80',
                            '25': 'Xhl=1.49 Xht=1.49 Xlt=1.00',
                            '37': 'Xhl=1.71 Xht=1.71 Xlt=1.14',
                            '50': 'Xhl=1.86 Xht=1.86 Xlt=1.24',
                            '75': 'Xhl=1.80 Xht=1.80 Xlt=1.20',
                            '100': 'Xhl=2.14 Xht=2.14 Xlt=1.43',   
                            '167': 'Xhl=2.35 Xht=2.35 Xlt=1.57', 
                            '250': 'Xhl=3.17 Xht=3.17 Xlt=2.11',
                            '333': 'Xhl=3.52 Xht=3.52 Xlt=2.35',
                            '500': 'Xhl=3.61 Xht=3.61 Xlt=2.40'},
                    '0.24':{
                            '3': 'Xhl=1.31 Xht=1.31 Xlt=0.87',
                            '5': 'Xhl=1.31 Xht=1.31 Xlt=0.87',
                            '10': 'Xhl=1.4 Xht=1.4 Xlt=0.94',
                            '15': 'Xhl=1.19 Xht=1.19 Xlt=0.79',
                            '25': 'Xhl=1.49 Xht=1.49 Xlt=0.99',
                            '37': 'Xhl=1.7 Xht=1.7 Xlt=1.14',
                            '50': 'Xhl=1.86 Xht=1.86 Xlt=1.24',
                            '75': 'Xhl=1.8 Xht=1.8 Xlt=1.2',
                            '100': 'Xhl=1.94 Xht=1.94 Xlt=1.3',
                            '167': 'Xhl=2.15 Xht=2.15 Xlt=1.43',
                            '250': 'Xhl=2.69 Xht=2.69 Xlt=1.79',
                            '333': 'Xhl=2.66 Xht=2.66 Xlt=1.78',
                            '500': 'Xhl=2.76 Xht=2.76 Xlt=1.84'}},
              '34.5':{
                    '0.12': {
                            '3': 'Xhl=4.92 Xht=4.92 Xlt=3.28',
                            '5': 'Xhl=4.92 Xht=4.92 Xlt=3.28', 
                            '10': 'Xhl=5.34 Xht=5.34 Xlt=3.56', 
                            '15': 'Xhl=5.52 Xht=5.52 Xlt=3.68',    
                            '25': 'Xhl=5.65 Xht=5.65 Xlt=3.77',
                            '37': 'Xhl=5.80 Xht=5.80 Xlt=3.87',   
                            '50': 'Xhl=5.90 Xht=5.90 Xlt=3.93',
                            '75': 'Xhl=5.94 Xht=5.94 Xlt=3.96',    
                            '100': 'Xhl=5.97 Xht=5.97 Xlt=3.98',
                            '167': 'Xhl=6.04 Xht=6.04 Xlt=4.03', 
                            '250': 'Xhl=6.08 Xht=6.08 Xlt=4.05', 
                            '333': 'Xhl=6.10 Xht=6.10 Xlt=4.07',   
                            '500': 'Xhl=6.12 Xht=6.12 Xlt=4.08',
                            '667': 'Xhl=6.12 Xht=6.12 Xlt=4.08',
                            '833': 'Xhl=6.12 Xht=6.12 Xlt=4.08'},
                    '0.24':{
                            '3': 'Xhl=4.92 Xht=4.92 Xlt=3.28',
                            '5': 'Xhl=4.92 Xht=4.92 Xlt=3.28',
                            '10': 'Xhl=5.34 Xht=5.34 Xlt=3.56',
                            '15': 'Xhl=5.52 Xht=5.52 Xlt=3.68',
                            '25': 'Xhl=5.65 Xht=5.65 Xlt=3.77',
                            '37': 'Xhl=5.8 Xht=5.8 Xlt=3.86',
                            '50': 'Xhl=5.89 Xht=5.89 Xlt=3.93',
                            '75': 'Xhl=5.94 Xht=5.94 Xlt=3.96',
                            '100': 'Xhl=5.98 Xht=5.98 Xlt=3.98',
                            '167': 'Xhl=6.04 Xht=6.04 Xlt=4.02',
                            '250': 'Xhl=6.07 Xht=6.07 Xlt=4.05',
                            '333': 'Xhl=6.1 Xht=6.1 Xlt=4.06',
                            '500': 'Xhl=6.12 Xht=6.12 Xlt=4.08',
                            '667': 'Xhl=6.12 Xht=6.12 Xlt=4.08',
                            '833': 'Xhl=6.12 Xht=6.12 Xlt=4.08'}}}
                            
res_list1F3W={ # List of resistances for single phase three winding transformers

              '2.4':{
                    '0.12': {
                            '3': '%Rs=[0.95 1.90 1.90]',
                            '5': '%Rs=[0.95 1.90 1.90]',
                            '10': '%Rs=[0.90 1.80 1.80]', 
                            '15': '%Rs=[0.80 1.60 1.60]',
                            '25': '%Rs=[0.71 1.42 1.42]',
                            '37': '%Rs=[0.65 1.29 1.29]',
                            '50': '%Rs=[0.56 1.12 1.12] ',
                            '75': '%Rs=[0.55 1.10 1.10]',
                            '100': '%Rs=[0.54 1.09 1.09]',                
                            '167': '%Rs=[0.54 1.07 1.07]', 
                            '250': '%Rs=[0.52 1.04 1.04]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]'},
                    '0.24':{
                             '3': '%Rs=[0.95 1.90 1.90]',
                            '5': '%Rs=[0.95 1.90 1.90]',
                            '10': '%Rs=[0.90 1.80 1.80]', 
                            '15': '%Rs=[0.80 1.60 1.60]',
                            '25': '%Rs=[0.71 1.42 1.42]',
                            '37': '%Rs=[0.65 1.29 1.29]',
                            '50': '%Rs=[0.56 1.12 1.12] ',
                            '75': '%Rs=[0.55 1.10 1.10]',
                           '100': '%Rs=[0.54 1.09 1.09]',                
                           '167': '%Rs=[0.54 1.07 1.07]', 
                           '250': '%Rs=[0.52 1.04 1.04]', 
                           '333': '%Rs=[0.50 1.00 1.00]',
                           '500': '%Rs=[0.50 1.00 1.00]',
                           '667': '%Rs=[0.50 1.00 1.00]'}},
             
             '4.16':{
                    '0.12': {
                             '3': '%Rs=[0.95 1.90 1.90]',
                            '5': '%Rs=[0.95 1.90 1.90]',
                            '10': '%Rs=[0.90 1.80 1.80]', 
                            '15': '%Rs=[0.80 1.60 1.60]',
                            '25': '%Rs=[0.71 1.42 1.42]',
                            '37': '%Rs=[0.65 1.29 1.29]',
                            '50': '%Rs=[0.56 1.12 1.12] ',
                            '75': '%Rs=[0.55 1.10 1.10]',
                            '100': '%Rs=[0.54 1.09 1.09]',                
                            '167': '%Rs=[0.54 1.07 1.07]', 
                            '250': '%Rs=[0.52 1.04 1.04]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]'},
                    '0.24':{
                            '3': '%Rs=[0.95 1.90 1.90]',
                            '5': '%Rs=[0.95 1.90 1.90]',
                            '10': '%Rs=[0.90 1.80 1.80]', 
                            '15': '%Rs=[0.80 1.60 1.60]',
                            '25': '%Rs=[0.71 1.42 1.42]',
                            '37': '%Rs=[0.65 1.29 1.29]',
                            '50': '%Rs=[0.56 1.12 1.12] ',
                            '75': '%Rs=[0.55 1.10 1.10]',
                            '100': '%Rs=[0.54 1.09 1.09]',                
                            '167': '%Rs=[0.54 1.07 1.07]', 
                            '250': '%Rs=[0.52 1.04 1.04]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]'}},
             '7.2':{
                    '0.12': {
                            '3': '%Rs=[0.95 1.90 1.90]',
                            '5': '%Rs=[0.95 1.90 1.90]',
                            '10': '%Rs=[0.90 1.80 1.80]', 
                            '15': '%Rs=[0.80 1.60 1.60]',
                            '25': '%Rs=[0.71 1.42 1.42]',
                            '37': '%Rs=[0.65 1.29 1.29]',
                            '50': '%Rs=[0.56 1.12 1.12] ',
                            '75': '%Rs=[0.55 1.10 1.10]',
                            '100': '%Rs=[0.54 1.09 1.09]',                
                            '167': '%Rs=[0.54 1.07 1.07]', 
                            '250': '%Rs=[0.52 1.04 1.04]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]'},
                    '0.24':{
                            '3': '%Rs=[0.95 1.90 1.90]',
                            '5': '%Rs=[0.95 1.90 1.90]',
                            '10': '%Rs=[0.90 1.80 1.80]', 
                            '15': '%Rs=[0.80 1.60 1.60]',
                            '25': '%Rs=[0.71 1.42 1.42]',
                            '37': '%Rs=[0.65 1.29 1.29]',
                            '50': '%Rs=[0.56 1.12 1.12] ',
                            '75': '%Rs=[0.55 1.10 1.10]',
                            '100': '%Rs=[0.54 1.09 1.09]',                
                            '167': '%Rs=[0.54 1.07 1.07]', 
                            '250': '%Rs=[0.52 1.04 1.04]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]'}},
            '13.8':{
                    '0.12': {
                            '3' : '%Rs=[0.95 1.90 1.90]',
                            '5' : '%Rs=[0.95 1.90 1.90]',
                            '10': '%Rs=[0.90 1.80 1.80]', 
                            '15': '%Rs=[0.80 1.60 1.60]',
                            '25': '%Rs=[0.71 1.42 1.42]',
                            '37': '%Rs=[0.65 1.29 1.29]',
                            '50': '%Rs=[0.56 1.12 1.12] ',
                            '75': '%Rs=[0.55 1.10 1.10]',
                            '100': '%Rs=[0.54 1.09 1.09]',                
                            '167': '%Rs=[0.54 1.07 1.07]', 
                            '250': '%Rs=[0.52 1.04 1.04]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]'},
                    '0.24':{
                            '3' : '%Rs=[0.95 1.90 1.90]',
                            '5' : '%Rs=[0.95 1.90 1.90]',
                            '10': '%Rs=[0.90 1.80 1.80]', 
                            '15': '%Rs=[0.80 1.60 1.60]',
                            '25': '%Rs=[0.71 1.42 1.42]',
                            '37': '%Rs=[0.65 1.29 1.29]',
                            '50': '%Rs=[0.56 1.12 1.12] ',
                            '75': '%Rs=[0.55 1.10 1.10]',
                            '100': '%Rs=[0.54 1.09 1.09]',                
                            '167': '%Rs=[0.54 1.07 1.07]', 
                            '250': '%Rs=[0.52 1.04 1.04]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]'}},
                 
            '24.9':{
                    '0.12': {
                            '3': '%Rs=[1.05 2.10 2.10]',
                            '5': '%Rs=[1.05 2.10 2.10]',
                            '10': '%Rs=[0.95 1.90 1.90]', 
                            '15': '%Rs=[0.88 1.77 1.77]',
                            '25': '%Rs=[0.77 1.54 1.54]',
                            '37': '%Rs=[0.71 1.41 1.41]',
                            '50': '%Rs=[0.68 1.35 1.35] ',
                            '75': '%Rs=[0.60 1.20 1.20]',
                            '100': '%Rs=[0.55 1.11 1.11]',                
                            '167': '%Rs=[0.50 1.00 1.00]', 
                            '250': '%Rs=[0.50 1.00 1.00]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]'},
                    '0.24':{
                             '3': '%Rs=[1.05 2.10 2.10]',
                             '5': '%Rs=[1.05 2.10 2.10]',
                            '10': '%Rs=[0.95 1.90 1.90]', 
                            '15': '%Rs=[0.88 1.77 1.77]',
                            '25': '%Rs=[0.77 1.54 1.54]',
                            '37': '%Rs=[0.71 1.41 1.41]',
                            '50': '%Rs=[0.68 1.35 1.35] ',
                            '75': '%Rs=[0.60 1.20 1.20]',
                            '100': '%Rs=[0.55 1.11 1.11]',                
                            '167': '%Rs=[0.50 1.00 1.00]', 
                            '250': '%Rs=[0.50 1.00 1.00]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]'}},
            '34.5':{
                    '0.12': {
                            '3': '%Rs=[1.05 2.10 2.10]',
                            '5': '%Rs=[1.05 2.10 2.10]',
                            '10': '%Rs=[0.98 1.95 1.95]', 
                            '15': '%Rs=[0.92 1.83 1.83]',
                            '25': '%Rs=[0.81 1.62 1.62]',
                            '37': '%Rs=[0.73 1.45 1.45]',
                            '50': '%Rs=[0.68 1.36 1.36]',
                            '75': '%Rs=[0.61 1.21 1.21]',
                            '100': '%Rs=[0.56 1.12 1.12]',
                            '167': '%Rs=[0.50 1.00 1.00]', 
                            '250': '%Rs=[0.50 1.00 1.00]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]',
                            '833': '%Rs=[0.50 1.00 1.00]'},
                    '0.24':{
                             '3': '%Rs=[1.05 2.10 2.10]',
                            '5': '%Rs=[1.05 2.10 2.10]',
                            '10': '%Rs=[0.98 1.95 1.95]', 
                            '15': '%Rs=[0.92 1.83 1.83]',
                            '25': '%Rs=[0.81 1.62 1.62]',
                            '37': '%Rs=[0.73 1.45 1.45]',
                            '50': '%Rs=[0.68 1.36 1.36]',
                            '75': '%Rs=[0.61 1.21 1.21]',
                            '100': '%Rs=[0.56 1.12 1.12]',
                            '167': '%Rs=[0.50 1.00 1.00]', 
                            '250': '%Rs=[0.50 1.00 1.00]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]',
                            '833': '%Rs=[0.50 1.00 1.00]'},
                    
                    '0.48':{
                             '3': '%Rs=[1.05 2.10 2.10]',
                            '5': '%Rs=[1.05 2.10 2.10]',
                            '10': '%Rs=[0.98 1.95 1.95]', 
                            '15': '%Rs=[0.92 1.83 1.83]',
                            '25': '%Rs=[0.81 1.62 1.62]',
                            '37': '%Rs=[0.73 1.45 1.45]',
                            '50': '%Rs=[0.68 1.36 1.36]',
                            '75': '%Rs=[0.61 1.21 1.21]',
                            '100': '%Rs=[0.56 1.12 1.12]',
                            '167': '%Rs=[0.50 1.00 1.00]', 
                            '250': '%Rs=[0.50 1.00 1.00]', 
                            '333': '%Rs=[0.50 1.00 1.00]',
                            '500': '%Rs=[0.50 1.00 1.00]',
                            '667': '%Rs=[0.50 1.00 1.00]',
                            '833': '%Rs=[0.50 1.00 1.00]'}}}

imp_list1F2W={'13.8':{# List of impedances for single phase two winding transformers [MV][LV][Power]
                    '0.12': {
                            '3': 'Xhl=0.69 %Rs=[0.95 0.95]',
                            '5': 'Xhl=0.69 %Rs=[0.95 0.95]',
                            '10': 'Xhl=1.28 %Rs=[0.90 0.90]',
                            '15': 'Xhl=0.99 %Rs=[0.80 0.80]',
                            '25': 'Xhl=1.24 %Rs=[0.71 0.71]',
                            '37': 'Xhl=1.42 %Rs=[0.65 0.65]',
                            '50': 'Xhl=1.55 %Rs=[0.56 0.56]',
                            '75': 'Xhl=1.50 %Rs=[0.55 0.55]',
                            '100': 'Xhl=1.79 %Rs=[0.54 0.54]',
                            '167': 'Xhl=1.96 %Rs=[0.54 0.54]', 
                            '250': 'Xhl=2.64 %Rs=[0.54 0.54]',
                            '333': 'Xhl=2.93 %Rs=[0.54 0.54]',
                            '500': 'Xhl=3.00 %Rs=[0.54 0.54]'},
                    '0.24':{
                            '3': 'Xhl=1.09 %Rs=[0.95 0.95]',
                            '5': 'Xhl=1.09 %Rs=[0.95 0.95]',
                            '10': 'Xhl=1.17 %Rs=[0.90 0.90]',
                            '15': 'Xhl=0.99 %Rs=[0.80 0.80]',
                            '25': 'Xhl=1.24 %Rs=[0.71 0.71]',
                            '37': 'Xhl=1.42 %Rs=[0.65 0.65]',
                            '50': 'Xhl=1.55 %Rs=[0.56 0.56]',
                            '75': 'Xhl=1.50 %Rs=[0.55 0.55]',
                            '100': 'Xhl=1.62 %Rs=[0.54 0.54]',
                            '167': 'Xhl=1.79 %Rs=[0.54 0.54]',
                            '250': 'Xhl=2.24 %Rs=[0.54 0.54]',
                            '333': 'Xhl=2.22 %Rs=[0.54 0.54]',
                            '500': 'Xhl=2.3 %Rs=[0.54 0.54]'}},
                            
              '24.9':{
                    '0.12': {
                            '3': 'Xhl=0.69 %Rs=[1.05 1.05]',
                            '5': 'Xhl=0.69 %Rs=[1.05 1.05]',
                            '10': 'Xhl=1.28 %Rs=[0.95 0.95]',
                            '15': 'Xhl=0.99 %Rs=[0.88 0.88]',
                            '25': 'Xhl=1.24 %Rs=[0.77 0.77]',
                            '37': 'Xhl=1.42 %Rs=[0.71 0.71]',
                            '50': 'Xhl=1.55 %Rs=[0.68 0.68]',
                            '75': 'Xhl=1.50 %Rs=[0.60 0.60]',
                            '100': 'Xhl=1.79 %Rs=[0.55 0.55]',   
                            '167': 'Xhl=1.96 %Rs=[0.50 0.50]', 
                            '250': 'Xhl=2.64 %Rs=[0.50 0.50]',
                            '333': 'Xhl=2.93 %Rs=[0.50 0.50]',
                            '500': 'Xhl=3.00 %Rs=[0.50 0.50]'},
                    '0.24':{
                            '3': 'Xhl=1.09 %Rs=[1.05 1.05]',
                            '5': 'Xhl=1.09 %Rs=[1.05 1.05]',
                            '10': 'Xhl=1.17 %Rs=[0.95 0.95]',
                            '15': 'Xhl=0.99 %Rs=[0.88 0.88]',
                            '25': 'Xhl=1.24 %Rs=[0.77 0.77]',
                            '37': 'Xhl=1.42 %Rs=[0.71 0.71]',
                            '50': 'Xhl=1.55 %Rs=[0.68 0.68]',
                            '75': 'Xhl=1.50 %Rs=[0.60 0.60]',
                            '100': 'Xhl=1.62 %Rs=[0.55 0.55]',
                            '167': 'Xhl=1.79 %Rs=[0.50 0.50]',
                            '250': 'Xhl=2.24 %Rs=[0.50 0.50]',
                            '333': 'Xhl=2.22 %Rs=[0.50 0.50]',
                            '500': 'Xhl=2.3 %Rs=[0.50 0.50]'}},
              '34.5':{
                    '0.12': {
                            '3': 'Xhl=4.10 %Rs=[1.05 1.05]', 
                            '5': 'Xhl=4.10 %Rs=[1.05 1.05]', 
                            '10': 'Xhl=4.45 %Rs=[0.98 0.98]', 
                            '15': 'Xhl=4.60 %Rs=[0.92 0.92]',    
                            '25': 'Xhl=4.71 %Rs=[0.81 0.81]',
                            '37': 'Xhl=4.83 %Rs=[0.73 0.73]',   
                            '50': 'Xhl=4.91 %Rs=[0.68 0.68]',
                            '75': 'Xhl=4.95 %Rs=[0.61 0.61]',    
                            '100': 'Xhl=4.98 %Rs=[0.56 0.56]',
                            '167': 'Xhl=5.03 %Rs=[0.50 0.50]', 
                            '250': 'Xhl=5.06 %Rs=[0.50 0.50]', 
                            '333': 'Xhl=5.08 %Rs=[0.50 0.50]',   
                            '500': 'Xhl=5.10 %Rs=[0.50 0.50]',
                            '833': 'Xhl=5.10 %Rs=[0.50 0.50]'},
                    
                    '0.24':{
                            '3': 'Xhl=4.10 %Rs=[1.05 1.05]',
                            '5': 'Xhl=4.10 %Rs=[1.05 1.05]',
                            '10': 'Xhl=4.45 %Rs=[0.98 0.98]',
                            '15': 'Xhl=4.60 %Rs=[0.92 0.92]',
                            '25': 'Xhl=4.71 %Rs=[0.81 0.81]',
                            '37': 'Xhl=4.83 %Rs=[0.73 0.73]',
                            '50': 'Xhl=4.91 %Rs=[0.68 0.68]',
                            '75': 'Xhl=4.95 %Rs=[0.61 0.61]',
                            '100': 'Xhl=4.98 %Rs=[0.56 0.56]',
                            '167': 'Xhl=5.03 %Rs=[0.50 0.50]',
                            '250': 'Xhl=5.06 %Rs=[0.50 0.50]',
                            '333': 'Xhl=5.08 %Rs=[0.50 0.50]',
                            '500': 'Xhl=5.10 %Rs=[0.50 0.50]',
                            '667': 'Xhl=5.10 %Rs=[0.50 0.50]'},
                    '0.48':{
                            '3': 'Xhl=4.10 %Rs=[1.05 1.05]',
                            '5': 'Xhl=4.10 %Rs=[1.05 1.05]',
                            '10': 'Xhl=4.45 %Rs=[0.98 0.98]',
                            '15': 'Xhl=4.60 %Rs=[0.92 0.92]',
                            '25': 'Xhl=4.71 %Rs=[0.81 0.81]',
                            '37': 'Xhl=4.83 %Rs=[0.73 0.73]',
                            '50': 'Xhl=4.91 %Rs=[0.68 0.68]',
                            '75': 'Xhl=4.95 %Rs=[0.61 0.61]',
                            '100': 'Xhl=4.98 %Rs=[0.56 0.56]',
                            '167': 'Xhl=5.03 %Rs=[0.50 0.50]',
                            '250': 'Xhl=5.06 %Rs=[0.50 0.50]',
                            '333': 'Xhl=5.08 %Rs=[0.50 0.50]',
                            '500': 'Xhl=5.10 %Rs=[0.50 0.50]',
                            '667': 'Xhl=5.10 %Rs=[0.50 0.50]'}}}
                            
                            
imp_list1F_mv_mv={ # List of impedances for single phase two winding transformers [MV][LV][Power]
            '13.8':{
                    '2.4':{}},

              '34.5':{
              
                    '14.38': {
                            '3': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '5': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '10': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '15': 'Xhl=1 %Rs=[0.1 0.1]',    
                            '25': 'Xhl=1 %Rs=[0.1 0.1]',
                            '37': 'Xhl=1 %Rs=[0.1 0.1]',   
                            '50': 'Xhl=1 %Rs=[0.1 0.1]',
                            '75': 'Xhl=1 %Rs=[0.1 0.1]',    
                            '100': 'Xhl=1 %Rs=[0.1 0.1]',
                            '167': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '250': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '333': 'Xhl=1 %Rs=[0.1 0.1]',   
                            '500': 'Xhl=1 %Rs=[0.1 0.1]'},
                            
                    '7.97': {
                            '3': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '5': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '10': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '15': 'Xhl=1 %Rs=[0.1 0.1]',    
                            '25': 'Xhl=1 %Rs=[0.1 0.1]',
                            '37': 'Xhl=1 %Rs=[0.1 0.1]',   
                            '50': 'Xhl=1 %Rs=[0.1 0.1]',
                            '75': 'Xhl=1 %Rs=[0.1 0.1]',    
                            '100': 'Xhl=1 %Rs=[0.1 0.1]',
                            '167': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '250': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '333': 'Xhl=1 %Rs=[0.1 0.1]',   
                            '500': 'Xhl=1 %Rs=[0.1 0.1]'},

                    '2.4': {
                            '3': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '5': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '10': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '15': 'Xhl=1 %Rs=[0.1 0.1]',    
                            '25': 'Xhl=1 %Rs=[0.1 0.1]',
                            '37': 'Xhl=1 %Rs=[0.1 0.1]',   
                            '50': 'Xhl=1 %Rs=[0.1 0.1]',
                            '75': 'Xhl=1 %Rs=[0.1 0.1]',    
                            '100': 'Xhl=1 %Rs=[0.1 0.1]',
                            '167': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '250': 'Xhl=1 %Rs=[0.1 0.1]', 
                            '333': 'Xhl=1 %Rs=[0.1 0.1]',   
                            '500': 'Xhl=1 %Rs=[0.1 0.1]'}}}                      
				
noloadloss_list1F={ 
                    '3': '%noloadloss=0.70',
                    '5': '%noloadloss=0.70',
                    '10': '%noloadloss=0.50',
                    '15': '%noloadloss=0.47',
                    '25': '%noloadloss=0.36',
                    '37': '%noloadloss=0.35',
                    '50': '%noloadloss=0.34',
                    '75': '%noloadloss=0.27',
                    '100': '%noloadloss=0.25',   
                    '167': '%noloadloss=0.24', 
                    '250': '%noloadloss=0.23',
                    '333': '%noloadloss=0.23',
                    '500': '%noloadloss=0.22',
                    '667': '%noloadloss=0.22',
                    '833': '%noloadloss=0.22'}
               				
imag_list1F={ 
              '3': '%imag=1.00',
              '5': '%imag=1.00',
              '10': '%imag=1.00',
              '15': '%imag=1.00',
              '25': '%imag=1.00',
              '37': '%imag=1.00',
              '50': '%imag=1.00',
              '75': '%imag=1.00',
              '100': '%imag=1.00',   
              '167': '%imag=1.00', 
              '250': '%imag=1.00',
              '333': '%imag=1.00',
              '500': '%imag=1.00',
              '667': '%imag=1.00',
              '833': '%imag=1.00'}				
							
imp_list3F={

        '2.4':{
                '9': 'Xhl=2.84 %Rs=[0.98 0.98]', 
                '30': 'Xhl=2.28 %Rs=[0.83 0.83]',
                '45': 'Xhl=2.08 %Rs=[0.76 0.76]',
                '75': 'Xhl=1.65 %Rs=[0.67 0.67]',
                '112': 'Xhl=1.30 %Rs=[0.61 0.61]',
                '150': 'Xhl=1.55 %Rs=[0.55 0.55]',
                '225': 'Xhl=1.55 %Rs=[0.56 0.56]', 
                '300': 'Xhl=1.67 %Rs=[0.50 0.50]',
                '500': 'Xhl=2.07 %Rs=[0.50 0.50]',
                '750': 'Xhl=5.59 %Rs=[0.48 0.48]',
                '1000': 'Xhl=5.61 %Rs=[0.46 0.46]',  
                '1500': 'Xhl=5.59 %Rs=[0.36 0.36]',
                '2500': 'Xhl=5.59 %Rs=[0.36 0.36]',
                '3000': 'Xhl=5.59 %Rs=[0.36 0.36]',				
                '3750': 'Xhl=5.59 %Rs=[0.30 0.30]',
                '5000': 'Xhl=5.59 %Rs=[0.30 0.30]',
                '7500': 'Xhl=5.59 %Rs=[0.27 0.27]',
                '10000': 'Xhl=5.59 %Rs=[0.24 0.24]',
                '15000': 'Xhl=5.59 %Rs=[0.22 0.22]',
                '20000': 'Xhl=5.59 %Rs=[0.20 0.20]',
                '25000': 'Xhl=5.59 %Rs=[0.19 0.19]'},
		'4.16':{
                '9': 'Xhl=2.84 %Rs=[0.98 0.98]', 
                '30': 'Xhl=2.28 %Rs=[0.83 0.83]',
                '45': 'Xhl=2.08 %Rs=[0.76 0.76]',
                '75': 'Xhl=1.65 %Rs=[0.67 0.67]',
                '112': 'Xhl=1.30 %Rs=[0.61 0.61]',
                '150': 'Xhl=1.55 %Rs=[0.55 0.55]',
                '225': 'Xhl=1.55 %Rs=[0.56 0.56]', 
                '300': 'Xhl=1.67 %Rs=[0.50 0.50]',
                '500': 'Xhl=2.07 %Rs=[0.50 0.50]',
                '750': 'Xhl=5.59 %Rs=[0.48 0.48]',
                '1000': 'Xhl=5.61 %Rs=[0.46 0.46]',  
                '1500': 'Xhl=5.59 %Rs=[0.40 0.40]',
                '2500': 'Xhl=5.59 %Rs=[0.36 0.36]',
                '3000': 'Xhl=5.59 %Rs=[0.36 0.36]',				
                '3750': 'Xhl=5.59 %Rs=[0.345 0.345]',
                '5000': 'Xhl=5.59 %Rs=[0.30 0.30]',
                '7500': 'Xhl=5.59 %Rs=[0.27 0.27]',
                '10000': 'Xhl=5.59 %Rs=[0.24 0.24]',
                '15000': 'Xhl=5.59 %Rs=[0.22 0.22]',
                '20000': 'Xhl=5.59 %Rs=[0.20 0.20]',
                '25000': 'Xhl=5.59 %Rs=[0.19 0.19]'},
                
            '7.2':{
                '9': 'Xhl=2.84 %Rs=[0.98 0.98]', 
                '30': 'Xhl=2.28 %Rs=[0.83 0.83]',
                '45': 'Xhl=2.08 %Rs=[0.76 0.76]',
                '75': 'Xhl=1.65 %Rs=[0.67 0.67]',
                '112': 'Xhl=1.30 %Rs=[0.61 0.61]',
                '150': 'Xhl=1.55 %Rs=[0.56 0.56]',
                '225': 'Xhl=1.55 %Rs=[0.53 0.53]', 
                '300': 'Xhl=1.67 %Rs=[0.50 0.50]',
                '500': 'Xhl=2.07 %Rs=[0.50 0.50]',
                '750': 'Xhl=5.59 %Rs=[0.48 0.48]',
                '1000': 'Xhl=5.61 %Rs=[0.46 0.46]',  
                '1500': 'Xhl=5.59 %Rs=[0.40 0.40]',
                '2500': 'Xhl=5.59 %Rs=[0.36 0.36]',
                '3000': 'Xhl=5.59 %Rs=[0.36 0.36]',				
                '3750': 'Xhl=5.59 %Rs=[0.345 0.345]',
                '5000': 'Xhl=5.59 %Rs=[0.30 0.30]',
                '7500': 'Xhl=5.59 %Rs=[0.27 0.27]',
                '10000': 'Xhl=5.59 %Rs=[0.24 0.24]',
                '15000': 'Xhl=5.59 %Rs=[0.22 0.22]',
                '20000': 'Xhl=5.59 %Rs=[0.20 0.20]',
                '25000': 'Xhl=5.59 %Rs=[0.19 0.19]'},
                
			'13.8':{
                '9': 'Xhl=2.84 %Rs=[0.98 0.98]', 
                '30': 'Xhl=2.28 %Rs=[0.83 0.83]',
                '45': 'Xhl=2.08 %Rs=[0.76 0.76]',
                '75': 'Xhl=1.65 %Rs=[0.67 0.67]',
                '112': 'Xhl=1.30 %Rs=[0.61 0.61]',
                '150': 'Xhl=1.55 %Rs=[0.56 0.56]',
                '225': 'Xhl=1.55 %Rs=[0.53 0.53]', 
                '300': 'Xhl=1.67 %Rs=[0.52 0.52]',
                '500': 'Xhl=2.07 %Rs=[0.50 0.50]',
                '750': 'Xhl=5.59 %Rs=[0.48 0.48]',
                '1000': 'Xhl=5.61 %Rs=[0.46 0.46]',  
                '1500': 'Xhl=5.59 %Rs=[0.40 0.40]',
                '2500': 'Xhl=5.59 %Rs=[0.36 0.36]',
                '3000': 'Xhl=5.59 %Rs=[0.36 0.36]',				
                '3750': 'Xhl=5.59 %Rs=[0.345 0.345]',
                '5000': 'Xhl=5.59 %Rs=[0.30 0.30]',
                '7500': 'Xhl=5.59 %Rs=[0.27 0.27]',
                '10000': 'Xhl=5.59 %Rs=[0.24 0.24]',
                '15000': 'Xhl=5.59 %Rs=[0.22 0.22]',
                '20000': 'Xhl=5.59 %Rs=[0.20 0.20]',
                '25000': 'Xhl=5.59 %Rs=[0.19 0.19]'},
            '24.9':{
                '9': 'Xhl=2.84 %Rs=[1.03 1.03]', 
                '30': 'Xhl=2.28 %Rs=[0.88 0.88]',
                '45': 'Xhl=2.08 %Rs=[0.81 0.81]',
                '75': 'Xhl=1.65 %Rs=[0.72 0.72]',
                '112': 'Xhl=1.30 %Rs=[0.63 0.63]',
                '150': 'Xhl=1.55 %Rs=[0.60 0.60]',
                '225': 'Xhl=1.55 %Rs=[0.55 0.55]', 
                '300': 'Xhl=1.67 %Rs=[0.52 0.52]',
                '500': 'Xhl=2.07 %Rs=[0.50 0.50]',
                '750': 'Xhl=5.59 %Rs=[0.48 0.48]',
                '1000': 'Xhl=5.49 %Rs=[0.455 0.455]',  
                '1500': 'Xhl=5.50 %Rs=[0.40 0.40]',
                '2500': 'Xhl=5.51 %Rs=[0.36 0.36]',				
                '3000': 'Xhl=5.51 %Rs=[0.36 0.36]',				
                '3750': 'Xhl=4.95 %Rs=[0.345 0.345]',
                '5000': 'Xhl=5.62 %Rs=[0.30 0.30]',
                '7500': 'Xhl=5.66 %Rs=[0.27 0.27]',
                '10000': 'Xhl=5.70 %Rs=[0.24 0.24]',
                '15000': 'Xhl=5.75 %Rs=[0.22 0.22]',
                '20000': 'Xhl=5.78 %Rs=[0.20 0.20]',
                '25000': 'Xhl=5.81 %Rs=[0.19 0.19]'},				
            '34.5':{
                '9': 'Xhl=3.96 %Rs=[1.10 1.10]', 
                '30': 'Xhl=4.80 %Rs=[0.93 0.93]',
                '45': 'Xhl=4.96 %Rs=[0.86 0.86]',
                '75': 'Xhl=5.11 %Rs=[0.77 0.77]',
                '112': 'Xhl=5.17 %Rs=[0.66 0.66]',
                '150': 'Xhl=5.24 %Rs=[0.64 0.64]',
                '225': 'Xhl=5.30 %Rs=[0.58 0.58]', 
                '300': 'Xhl=5.32 %Rs=[0.54 0.54]',
                '500': 'Xhl=5.37 %Rs=[0.52 0.52]',
                '750': 'Xhl=5.40 %Rs=[0.518 0.518]',
                '1000': 'Xhl=5.49 %Rs=[0.455 0.455]',  
                '1500': 'Xhl=5.50 %Rs=[0.40 0.40]',
                '2000': 'Xhl=5.51 %Rs=[0.36 0.36]',
                '2500': 'Xhl=5.51 %Rs=[0.36 0.36]',				
                '3000': 'Xhl=5.51 %Rs=[0.36 0.36]',				
                '3750': 'Xhl=4.95 %Rs=[0.345 0.345]',
                '5000': 'Xhl=5.62 %Rs=[0.30 0.30]',
                '7500': 'Xhl=5.66 %Rs=[0.27 0.27]',
                '10000': 'Xhl=5.70 %Rs=[0.24 0.24]',
                '15000': 'Xhl=5.75 %Rs=[0.22 0.22]',
                '20000': 'Xhl=5.78 %Rs=[0.20 0.20]',
                '25000': 'Xhl=5.81 %Rs=[0.19 0.19]'}}
        
noloadloss_list3F={ '9': '%noloadloss=0.53',
                    '30': '%noloadloss=0.47',
                    '45': '%noloadloss=0.41',
                    '75': '%noloadloss=0.36',
                    '112': '%noloadloss=0.33',
                    '150': '%noloadloss=0.30',
                    '225': '%noloadloss=0.28', 
                    '300': '%noloadloss=0.25',
                    '500': '%noloadloss=0.24', 
                    '750': '%noloadloss=0.23',
                    '1000': '%noloadloss=0.21',
                    '1500': '%noloadloss=0.19',
                    '2000': '%noloadloss=0.17',
                    '2500': '%noloadloss=0.17',
                    '3000': '%noloadloss=0.17',
                    '3750': '%noloadloss=0.15',
                    '5000': '%noloadloss=0.14',
                    '7500': '%noloadloss=0.12',
                    '10000': '%noloadloss=0.11',
                    '15000': '%noloadloss=0.10',
                    '20000': '%noloadloss=0.09',
                    '25000': '%noloadloss=0.08'}
               				
imag_list3F={ '9': '%imag=1.00',
             '30': '%imag=1.00',
             '45': '%imag=1.00',
             '75': '%imag=1.00',
             '112': '%imag=1.00',
             '150': '%imag=1.00',   
             '225': '%imag=1.00', 
             '300': '%imag=1.00',
             '500': '%imag=1.00', 
             '750': '%imag=1.00',
             '1000': '%imag=1.00',  
             '1500': '%imag=1.00',
             '2000': '%imag=1.00',
             '2500': '%imag=1.00',				
             '3000': '%imag=1.00',				
             '3750': '%imag=1.00',
             '5000': '%imag=1.00', 
             '7500': '%imag=1.00',
             '10000': '%imag=1.00',  
             '15000': '%imag=1.00',
             '20000': '%imag=1.00',
             '25000': '%imag=1.00'}
		
		
def impedanceSingleUnit(phase,voltageMV, voltageLV, rated_power, mv_mv=False): 
    phase = str(phase)
    voltageMV = str(voltageMV)
    if voltageMV == "13.2":
        voltageMV = "13.8"
    if voltageLV == "0.277":
        voltageLV = "0.24"
    voltageLV = str(voltageLV)
    power = str(int(float(rated_power)))
    
    #Trifásico
    if phase == '3':
        # Aproximacion de power
        dict_ = imp_list3F[voltageMV]
        power = power if power in dict_ else min(dict_.keys(), key=lambda k: abs(float(k)-float(power)))
        in_imp = power in list(imp_list3F[voltageMV].keys())
        if in_imp == True:
            imp_out = imp_list3F[voltageMV][power]
            imag_out = imag_list3F[power]
            noloadloss_out = noloadloss_list3F[power]
            imp = {'Z': imp_out, 'Im': imag_out, 'Pnoload': noloadloss_out}
        else:
            aviso= 'No existen valores de reactancia y resistencia para transformadores trifásicos de '
            aviso += power + ' kVA operando en ' + voltageMV + ' kV.'
            QgsMessageLog.logMessage(aviso, 'Transformadores', Qgis.Warning)
            imp_out = ' %R=UNKNOWN Xhl=UNKNOWN '
            imp = {'Z': imp_out, 'Im': '%imag=1.00', 'Pnoload': '%noloadloss=0.20'}
    
    # Monofásico
    elif phase == '1':
        if power == "37.5" or power == "38":
            power = "37"
            
        flag = False # bandera para indicar si se encontraron los datos
        # Caso trafo mv - mv
        if mv_mv == True:
            # Aproximacion de power
            dict_ = imp_list1F_mv_mv[voltageMV][voltageLV]
            power = power if power in dict_ else min(dict_.keys(), key=lambda k: abs(float(k)-float(power)))
            in_imped = power in list(imp_list1F_mv_mv[voltageMV][voltageLV].keys())
            if in_imped == True:
                imp = imp_list1F_mv_mv[voltageMV][voltageLV][power]
                imp = imp.split('%') # Ejemplo: 'Xhl=1 %Rs=[0.1 0.1]'
                rea_out = imp[0]
                res_out = '%' + imp[1]
                imag_out = imag_list1F[power]	
                noloadloss_out = noloadloss_list1F[power]			
                imp = {'X': rea_out, 'R': res_out, 'Im': imag_out,
                      'Pnoload': noloadloss_out}
            else:
                flag = True
        
        # Caso que no sea mv-mv
        else:
            # Aproximacion de power
            x = react_list1F3W.get(voltageMV)
            if not x:
                aviso= 'No existen valores de reactancia y resistencia '
                aviso += 'para transformadores monofásicos de '
                aviso += power + ' kVA operando en ' + voltageMV + ' kV.'
                QgsMessageLog.logMessage(aviso, 'Transformadores', Qgis.Warning)
                rea_out = ' Xhl=UNKNOWN Xht=UNKNOWN Xlt=UNKNOWN '
                res_out = ' %Rs=[UNKNOWN] '
                imp = {'X': rea_out, 'R': res_out,
                      'Im': '%imag=1.00', 'Pnoload': '%noloadloss=0.20'}
                return imp
            x = x.get(voltageLV)
            if not x:
                aviso= 'No existen valores de reactancia y resistencia '
                aviso += 'para transformadores monofásicos de '
                aviso += power + ' kVA operando en ' + voltageMV + ' kV.'
                QgsMessageLog.logMessage(aviso, 'Transformadores', Qgis.Warning)
                rea_out = ' Xhl=UNKNOWN Xht=UNKNOWN Xlt=UNKNOWN '
                res_out = ' %Rs=[UNKNOWN] '
                imp = {'X': rea_out, 'R': res_out,
                      'Im': '%imag=1.00', 'Pnoload': '%noloadloss=0.20'}
                return imp
            dict_ = react_list1F3W[voltageMV][voltageLV]
            power = power if power in dict_ else min(dict_.keys(), key=lambda k: abs(float(k)-float(power)))
            in_react = power in list(react_list1F3W[voltageMV][voltageLV].keys())
            in_resist = power in list(res_list1F3W[voltageMV][voltageLV].keys())
            if in_react == True and in_resist == True:
                rea_out = react_list1F3W[voltageMV][voltageLV][power]#####
                res_out = res_list1F3W[voltageMV][voltageLV][power]####
                imag_out = imag_list1F[power]	
                noloadloss_out = noloadloss_list1F[power]			
                imp = {'X': rea_out, 'R': res_out,
                      'Im':imag_out, 'Pnoload': noloadloss_out}
            else:
                flag = True
        
        # En caso de que no se haya encontrado
        if flag == True:
            aviso= 'No existen valores de reactancia y resistencia '
            aviso += 'para transformadores monofásicos de '
            aviso += power + ' kVA operando en ' + voltageMV + ' kV.'
            QgsMessageLog.logMessage(aviso, 'Transformadores', Qgis.Warning)
            rea_out = ' Xhl=UNKNOWN Xht=UNKNOWN Xlt=UNKNOWN '
            res_out = ' %Rs=[UNKNOWN] '
            imp = {'X': rea_out, 'R': res_out,
                  'Im': '%imag=1.00', 'Pnoload': '%noloadloss=0.20'}
    return imp

def impedanceMultiUnit(voltageMV,voltageLV, rated_powerA,rated_powerB,rated_powerC, phase):
    voltageMV = str(voltageMV)
    if voltageMV == "13.2":
        voltageMV = "13.8"
    voltageLV = str(voltageLV)
    powerA = str(int(float(rated_powerA)))
    powerB = str(int(float(rated_powerB)))
    powerC = str(int(float(rated_powerC)))
    if powerA == "38":
        powerA = "37"
    if powerB == "38":
        powerB = "37"
    if powerC == "38":
        powerC = "37"
    if voltageLV =="0.277":
        voltageLV = "0.24"
    # Aproximacion de powerA
    dict_ = imp_list1F2W[voltageMV][voltageLV]
    powerA = powerA if powerA in dict_ else min(dict_.keys(), key=lambda k: abs(float(k)-float(powerA)))
    if (powerA in list(imp_list1F2W[voltageMV][voltageLV].keys())):
        imp_outA = imp_list1F2W[voltageMV][voltageLV][powerA]
        imag_outA = imag_list1F[powerA]	
        noloadloss_outA = noloadloss_list1F[powerA]		
        impA = {'Za': imp_outA, 'ImA': imag_outA,
                'PnoloadA': noloadloss_outA}
    else:
        aviso = 'No existen valores de reactancia y resistencia '
        aviso += 'para transformadores monofasicos de '
        aviso += powerA + ' kVA operando en ' + voltageMV + ' kV.'
        QgsMessageLog.logMessage(aviso, QCoreApplication.translate('dialog', 'Transformadores'), Qgis.Warning)        
        imp_outA = '%R=UNKNOWN Xhl=UNKNOWN'
        impA = {'Za': imp_outA, 'ImA': '%imag=1.00',
                'PnoloadA': '%noloadloss=0.20'}
    
    # Aproximacion de powerB
    dict_ = react_list1F3W[voltageMV][voltageLV]
    powerB = powerB if powerB in dict_ else min(dict_.keys(), key=lambda k: abs(float(k)-float(powerB)))
    in_rea = powerB in list(react_list1F3W[voltageMV][voltageLV].keys())
    in_res = powerB in list(res_list1F3W[voltageMV][voltageLV].keys())
    if in_rea == True and in_res == True:
        rea_outB = react_list1F3W[voltageMV][voltageLV][powerB]####3
        res_outB = res_list1F3W[voltageMV][voltageLV][powerB]#####
        imp_outB = imp_list1F2W[voltageMV][voltageLV][powerB]  #####
        imag_outB = imag_list1F[powerB]
        noloadloss_outB = noloadloss_list1F[powerB]
        impB =  {'Xb': rea_outB, 'Rb': res_outB, 'ImB': imag_outB, 
                'PnoloadB': noloadloss_outB, 'Zb': imp_outB}
    else:
        aviso= 'No existen valores de reactancia y resistencia '
        aviso += 'para transformadores monofasicos de '
        aviso += powerB + ' kVA operando en ' + voltageMV + ' kV.'
        QgsMessageLog.logMessage(aviso,u'Transformadores',Qgis.Warning)
        rea_outB = 'Xhl=UNKNOWN Xht=UNKNOWN Xlt=UNKNOWN'
        res_outB = '%Rs=[UNKNOWN]'
        imp_outB = '%R=UNKNOWN Xhl=UNKNOWN'
        impB =  {'Xb': rea_outB, 'Rb': res_outB, 'ImB': '%imag=1.00',
                'PnoloadB': '%noloadloss=0.20', 'Zb': imp_outB}
    if phase !='.2.3' and phase !='.1.3'and phase !='.1.2':
        # Aproximacion de powerC
        dict_ = imp_list1F2W[voltageMV][voltageLV]
        powerC = powerC if powerC in dict_ else min(dict_.keys(), key=lambda k: abs(float(k)-float(powerC)))
        if (powerC in list(imp_list1F2W[voltageMV][voltageLV].keys())):
            imp_outC = imp_list1F2W[voltageMV][voltageLV][powerC]
            imag_outC = imag_list1F[powerC]	
            noloadloss_outC = noloadloss_list1F[powerC]			
            impC = {'Zc': imp_outC, 'ImC': imag_outC,
                    'PnoloadC': noloadloss_outC}
        else:
            aviso = 'No existen valores de reactancia y resistencia'
            aviso += ' para transformadores monofasicos de '
            aviso += powerC + ' kVA operando en ' + voltageMV + ' kV.'
            QgsMessageLog.logMessage(aviso, 'Transformadores', Qgis.Warning)
            imp_outC = '%R=UNKNOWN Xhl=UNKNOWN'
            impC = {'Zc': imp_outC, 'ImC': '%imag=1.00',
                   'PnoloadC': '%noloadloss=0.20'}
    else:
        imp_outC = '%R=UNKNOWN Xhl=UNKNOWN'
        impC = {'Zc': imp_outC, 'ImC': '%imag=1.00',
                'PnoloadC': '%noloadloss=0.20'}
    impBanco = {'impA': impA, 'impB': impB, 'impC': impC}
    return impBanco
